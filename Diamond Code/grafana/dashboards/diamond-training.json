{
  "annotations": {
    "list": [
      {
        "builtIn": 0,
        "datasource": { "type": "influxdb", "uid": "efd1xv51o3vuob" },
        "enable": true,
        "hide": false,
        "iconColor": "#FF9830",
        "name": "Control Changes",
        "target": {
          "refId": "Anno",
          "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"control_change\")\n  |> filter(fn: (r) => r._field == \"description\")\n  |> keep(columns: [\"_time\", \"_value\", \"key\"])"
        },
        "textColumn": "_value",
        "tagsColumn": "key",
        "type": "tags"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "liveNow": true,
  "panels": [
    {
      "id": 1,
      "title": "Step",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 0, "y": 0 },
      "datasource": { "type": "influxdb", "uid": "efd1xv51o3vuob" },
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"training_step\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r.is_eval == \"false\")\n  |> filter(fn: (r) => r._field == \"step\")\n  |> last()"
      }],
      "fieldConfig": {
        "defaults": { "color": { "mode": "thresholds" }, "thresholds": { "steps": [{ "color": "blue", "value": null }] } },
        "overrides": []
      },
      "options": { "colorMode": "value", "graphMode": "none", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "id": 2,
      "title": "Loss",
      "type": "stat",
      "gridPos": { "h": 4, "w": 5, "x": 4, "y": 0 },
      "datasource": { "type": "influxdb", "uid": "efd1xv51o3vuob" },
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"training_step\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r.is_eval == \"false\")\n  |> filter(fn: (r) => r._field == \"loss\")\n  |> last()"
      }],
      "fieldConfig": {
        "defaults": { "color": { "mode": "thresholds" }, "decimals": 4, "thresholds": { "steps": [{ "color": "orange", "value": null }] } },
        "overrides": []
      },
      "options": { "colorMode": "value", "graphMode": "area", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "id": 3,
      "title": "Bit Accuracy",
      "type": "stat",
      "gridPos": { "h": 4, "w": 5, "x": 9, "y": 0 },
      "datasource": { "type": "influxdb", "uid": "efd1xv51o3vuob" },
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"training_step\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r.is_eval == \"false\")\n  |> filter(fn: (r) => r._field == \"bit_acc\")\n  |> last()"
      }],
      "fieldConfig": {
        "defaults": { "color": { "mode": "thresholds" }, "unit": "percentunit", "thresholds": { "steps": [{ "color": "red", "value": null }, { "color": "yellow", "value": 0.6 }, { "color": "green", "value": 0.9 }] } },
        "overrides": []
      },
      "options": { "colorMode": "value", "graphMode": "area", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "id": 4,
      "title": "Oracle",
      "type": "stat",
      "gridPos": { "h": 4, "w": 5, "x": 14, "y": 0 },
      "datasource": { "type": "influxdb", "uid": "efd1xv51o3vuob" },
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"training_step\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r.is_eval == \"false\")\n  |> filter(fn: (r) => r._field == \"oracle\")\n  |> last()"
      }],
      "fieldConfig": {
        "defaults": { "color": { "mode": "thresholds" }, "unit": "percentunit", "thresholds": { "steps": [{ "color": "purple", "value": null }, { "color": "green", "value": 0.5 }] } },
        "overrides": []
      },
      "options": { "colorMode": "value", "graphMode": "area", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "id": 5,
      "title": "s/step",
      "type": "stat",
      "gridPos": { "h": 4, "w": 5, "x": 19, "y": 0 },
      "datasource": { "type": "influxdb", "uid": "efd1xv51o3vuob" },
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"training_step\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r.is_eval == \"false\")\n  |> filter(fn: (r) => r._field == \"s_per_step\")\n  |> last()"
      }],
      "fieldConfig": {
        "defaults": { "color": { "mode": "thresholds" }, "unit": "s", "decimals": 3, "thresholds": { "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 0.5 }, { "color": "red", "value": 2 }] } },
        "overrides": []
      },
      "options": { "colorMode": "value", "graphMode": "none", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "id": 10,
      "title": "Loss & Accuracy",
      "type": "timeseries",
      "gridPos": { "h": 10, "w": 12, "x": 0, "y": 4 },
      "datasource": { "type": "influxdb", "uid": "efd1xv51o3vuob" },
      "targets": [
        {
          "refId": "A",
          "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"training_step\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r.is_eval == \"false\")\n  |> filter(fn: (r) => r._field == \"loss\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)",
          "hide": false
        },
        {
          "refId": "B",
          "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"training_step\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r.is_eval == \"false\")\n  |> filter(fn: (r) => r._field == \"bit_acc\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)",
          "hide": false
        },
        {
          "refId": "C",
          "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"training_step\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r.is_eval == \"true\")\n  |> filter(fn: (r) => r._field == \"loss\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)",
          "hide": false
        }
      ],
      "fieldConfig": {
        "defaults": { "custom": { "lineWidth": 2, "fillOpacity": 10, "axisPlacement": "auto" } },
        "overrides": [
          { "matcher": { "id": "byFrameRefID", "options": "A" }, "properties": [{ "id": "displayName", "value": "Train Loss" }, { "id": "color", "value": { "fixedColor": "orange", "mode": "fixed" } }, { "id": "custom.axisPlacement", "value": "left" }] },
          { "matcher": { "id": "byFrameRefID", "options": "B" }, "properties": [{ "id": "displayName", "value": "Bit Acc" }, { "id": "color", "value": { "fixedColor": "#00BBFF", "mode": "fixed" } }, { "id": "custom.axisPlacement", "value": "right" }] },
          { "matcher": { "id": "byFrameRefID", "options": "C" }, "properties": [{ "id": "displayName", "value": "Eval Loss" }, { "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }, { "id": "custom.lineStyle", "value": { "fill": "dot" } }] }
        ]
      },
      "options": { "tooltip": { "mode": "multi" }, "legend": { "displayMode": "list", "placement": "bottom" } }
    },
    {
      "id": 11,
      "title": "Oracle Gap",
      "type": "timeseries",
      "gridPos": { "h": 10, "w": 12, "x": 12, "y": 4 },
      "datasource": { "type": "influxdb", "uid": "efd1xv51o3vuob" },
      "targets": [
        {
          "refId": "A",
          "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"training_step\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r.is_eval == \"false\")\n  |> filter(fn: (r) => r._field == \"bit_acc\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)"
        },
        {
          "refId": "B",
          "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"training_step\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r.is_eval == \"false\")\n  |> filter(fn: (r) => r._field == \"oracle\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)"
        },
        {
          "refId": "C",
          "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"training_step\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r.is_eval == \"false\")\n  |> filter(fn: (r) => r._field == \"bit_oracle\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)"
        },
        {
          "refId": "D",
          "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"training_step\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r.is_eval == \"false\")\n  |> filter(fn: (r) => r._field == \"ensemble_benefit\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)"
        }
      ],
      "fieldConfig": {
        "defaults": { "custom": { "lineWidth": 2, "fillOpacity": 5 }, "unit": "percentunit" },
        "overrides": [
          { "matcher": { "id": "byFrameRefID", "options": "A" }, "properties": [{ "id": "displayName", "value": "Bit Acc (ensemble)" }, { "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }, { "id": "custom.lineWidth", "value": 3 }] },
          { "matcher": { "id": "byFrameRefID", "options": "B" }, "properties": [{ "id": "displayName", "value": "Oracle" }, { "id": "color", "value": { "fixedColor": "#00FF88", "mode": "fixed" } }, { "id": "custom.lineStyle", "value": { "fill": "dash" } }] },
          { "matcher": { "id": "byFrameRefID", "options": "C" }, "properties": [{ "id": "displayName", "value": "Bit Oracle" }, { "id": "color", "value": { "fixedColor": "yellow", "mode": "fixed" } }, { "id": "custom.lineStyle", "value": { "fill": "dot" } }] },
          { "matcher": { "id": "byFrameRefID", "options": "D" }, "properties": [{ "id": "displayName", "value": "Ensemble Benefit" }, { "id": "color", "value": { "fixedColor": "gold", "mode": "fixed" } }] }
        ]
      },
      "options": { "tooltip": { "mode": "multi" }, "legend": { "displayMode": "list", "placement": "bottom" } }
    },
    {
      "id": 20,
      "title": "Circular Spread",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 14 },
      "datasource": { "type": "influxdb", "uid": "efd1xv51o3vuob" },
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"training_step\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r.is_eval == \"false\")\n  |> filter(fn: (r) => r._field == \"circular_spread\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)"
      }],
      "fieldConfig": {
        "defaults": { "custom": { "lineWidth": 2, "fillOpacity": 20 }, "color": { "fixedColor": "#00D9FF", "mode": "fixed" } },
        "overrides": []
      },
      "options": { "tooltip": { "mode": "single" } }
    },
    {
      "id": 21,
      "title": "Coverage & Clustering",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 14 },
      "datasource": { "type": "influxdb", "uid": "efd1xv51o3vuob" },
      "targets": [
        {
          "refId": "A",
          "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"training_step\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r.is_eval == \"false\")\n  |> filter(fn: (r) => r._field == \"coverage\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)"
        },
        {
          "refId": "B",
          "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"training_step\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r.is_eval == \"false\")\n  |> filter(fn: (r) => r._field == \"clustering\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)"
        }
      ],
      "fieldConfig": {
        "defaults": { "custom": { "lineWidth": 2 } },
        "overrides": [
          { "matcher": { "id": "byFrameRefID", "options": "A" }, "properties": [{ "id": "displayName", "value": "Coverage" }, { "id": "color", "value": { "fixedColor": "#7DFF8C", "mode": "fixed" } }, { "id": "custom.axisPlacement", "value": "left" }] },
          { "matcher": { "id": "byFrameRefID", "options": "B" }, "properties": [{ "id": "displayName", "value": "Clustering" }, { "id": "color", "value": { "fixedColor": "#FF6B9D", "mode": "fixed" } }, { "id": "custom.axisPlacement", "value": "right" }, { "id": "custom.lineStyle", "value": { "fill": "dot" } }] }
        ]
      }
    },
    {
      "id": 30,
      "title": "Per-Being Jump Rates",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 22 },
      "datasource": { "type": "influxdb", "uid": "efd1xv51o3vuob" },
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"being_metric\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r._field == \"jump_rate\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)"
      }],
      "fieldConfig": {
        "defaults": { "custom": { "lineWidth": 2 } },
        "overrides": []
      },
      "options": { "tooltip": { "mode": "multi" }, "legend": { "displayMode": "list", "placement": "bottom" } }
    },
    {
      "id": 31,
      "title": "Ant Sizes (K bits)",
      "type": "barchart",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 22 },
      "datasource": { "type": "influxdb", "uid": "efd1xv51o3vuob" },
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"being_metric\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r._field == \"k_bits\")\n  |> last()\n  |> group(columns: [\"being_id\"])"
      }],
      "fieldConfig": {
        "defaults": { "color": { "mode": "palette-classic" } },
        "overrides": []
      },
      "options": { "orientation": "horizontal", "showValue": "always", "xTickLabelRotation": 0 }
    },
    {
      "id": 40,
      "title": "Per-Being Masked Accuracy",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 30 },
      "datasource": { "type": "influxdb", "uid": "efd1xv51o3vuob" },
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"being_metric\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r._field == \"masked_acc\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)"
      }],
      "fieldConfig": {
        "defaults": { "custom": { "lineWidth": 2 }, "unit": "percentunit" },
        "overrides": []
      },
      "options": { "tooltip": { "mode": "multi" }, "legend": { "displayMode": "list", "placement": "bottom" } }
    },
    {
      "id": 41,
      "title": "Per-Bit Accuracy Heatmap",
      "type": "heatmap",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 30 },
      "datasource": { "type": "influxdb", "uid": "efd1xv51o3vuob" },
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"bit_accuracy\")\n  |> filter(fn: (r) => r.run_id == \"${run_id}\")\n  |> filter(fn: (r) => r._field == \"accuracy\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)"
      }],
      "fieldConfig": {
        "defaults": { "custom": { "scaleDistribution": { "type": "linear" } } },
        "overrides": []
      },
      "options": {
        "color": { "scheme": "Viridis", "mode": "scheme" },
        "yAxis": { "unit": "" },
        "cellGap": 1,
        "calculate": false,
        "tooltip": { "show": true }
      }
    },
    {
      "id": 50,
      "title": "Live Controls (LR & Think Ticks)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 38 },
      "datasource": { "type": "influxdb", "uid": "efd1xv51o3vuob" },
      "targets": [
        {
          "refId": "A",
          "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"control_value\")\n  |> filter(fn: (r) => r.key == \"lr\")\n  |> filter(fn: (r) => r._field == \"value\")"
        },
        {
          "refId": "B",
          "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"control_value\")\n  |> filter(fn: (r) => r.key == \"think_ticks\")\n  |> filter(fn: (r) => r._field == \"value\")"
        }
      ],
      "fieldConfig": {
        "defaults": { "custom": { "lineWidth": 2, "staircase": true, "fillOpacity": 10 } },
        "overrides": [
          { "matcher": { "id": "byFrameRefID", "options": "A" }, "properties": [{ "id": "displayName", "value": "Learning Rate" }, { "id": "color", "value": { "fixedColor": "#FF9830", "mode": "fixed" } }, { "id": "custom.axisPlacement", "value": "left" }] },
          { "matcher": { "id": "byFrameRefID", "options": "B" }, "properties": [{ "id": "displayName", "value": "Think Ticks" }, { "id": "color", "value": { "fixedColor": "#00D9FF", "mode": "fixed" } }, { "id": "custom.axisPlacement", "value": "right" }] }
        ]
      },
      "options": { "tooltip": { "mode": "multi" }, "legend": { "displayMode": "list", "placement": "bottom" } }
    },
    {
      "id": 51,
      "title": "Control Change Log",
      "type": "logs",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 38 },
      "datasource": { "type": "influxdb", "uid": "efd1xv51o3vuob" },
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"diamond\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"control_change\")\n  |> filter(fn: (r) => r._field == \"description\")\n  |> keep(columns: [\"_time\", \"_value\", \"key\"])\n  |> rename(columns: {_value: \"line\"})"
      }],
      "options": { "showTime": true, "sortOrder": "Descending", "wrapLogMessage": true, "enableLogDetails": true }
    }
  ],
  "refresh": "5s",
  "schemaVersion": 39,
  "tags": ["diamond", "training", "vraxion"],
  "templating": {
    "list": [
      {
        "current": {},
        "datasource": { "type": "influxdb", "uid": "efd1xv51o3vuob" },
        "definition": "import \"influxdata/influxdb/schema\"\nschema.tagValues(bucket: \"diamond\", tag: \"run_id\")",
        "description": "Training run ID",
        "includeAll": false,
        "label": "Run",
        "multi": false,
        "name": "run_id",
        "options": [],
        "query": "import \"influxdata/influxdb/schema\"\nschema.tagValues(bucket: \"diamond\", tag: \"run_id\")",
        "refresh": 2,
        "sort": 2,
        "type": "query"
      }
    ]
  },
  "time": { "from": "now-1h", "to": "now" },
  "timepicker": {},
  "timezone": "",
  "title": "Diamond Code Training",
  "uid": "diamond-training-v1",
  "version": 1
}
