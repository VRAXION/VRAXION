# Ant Ratio Packet v0 (VRA-76)

This document defines the **joined datapoint schema** used by the VRA-76/77/78
"ant ratio" pipeline.

The goal is to keep the *rankable* datapoint logic auditable:

- Cost metrics come from the GPU probe harness artifacts.
- Capability metrics come from assoc-byte evaluation artifacts.
- PASS/FAIL is read from the artifacts (never from process exit codes).

## Source Artifacts

### Probe run root (cost, stability, throughput)
Generated by `Golden Draft/tools/gpu_capacity_probe.py` and contains:

- `metrics.json`
- `env.json`
- `run_cmd.txt` (JSON)

Authoritative fields:

- `metrics.json.stability_pass` and `metrics.json.had_oom/had_nan/had_inf`
- `metrics.json.throughput_tokens_per_s`
- `metrics.json.peak_vram_reserved_bytes`
- `env.json.total_vram_bytes`

### Assoc run root (capability)
Generated by a capability pipeline and must contain:

- `report.json`

Authoritative fields (current regime):

- `report.json.eval.eval_acc`
- `report.json.settings.eval_disjoint`

## Packet Schema

The packet is a single JSON object with `schema_version = "ant_ratio_packet_v0"`.
It is produced by:

```
python "Golden Draft/tools/ant_ratio_packet_v0.py" --probe-run-root <dir> --assoc-run-root <dir>
```

Required keys (present, may be `null` if the source artifact is missing data):

- Identity: `ant_tier`, `ant_ring_len`, `ant_slot_dim`, `expert_heads`, `batch_size`, `precision`, `amp`, `seq_len`
- Cost: `vram_ratio_reserved`, `throughput_tokens_per_s`
- Capability: `assoc_byte_disjoint_accuracy`, `assoc_eval_disjoint`
- Stability: `stability_pass`, `fail_reasons`, `had_oom`, `had_nan`, `had_inf`
- Provenance: `probe_run_root`, `assoc_run_root`, `git_commit`, `generated_utc`

## PASS/FAIL Rule (Locked)

Never classify by process exit code.

PASS iff:

- `metrics.json.stability_pass == true`, and
- `had_oom == false`, `had_nan == false`, `had_inf == false`

## Fairness Metadata (Token Budget)

The packet optionally records a fixed token budget policy:

- `token_budget`
- `token_budget_tokens_per_step`
- `token_budget_steps`

This supports comparisons across different batch sizes without accidentally
rewarding "bigger batch saw more data" when the training step budget is fixed.

